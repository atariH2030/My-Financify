#!/bin/sh
# Pre-commit hook para qualidade de c√≥digo
# Instalar: npm run setup:hooks

echo "üîç Running pre-commit quality checks..."

# 1. Verificar arquivos staged
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$')

if [ -z "$FILES" ]; then
  echo "‚úÖ No TypeScript files to check"
  exit 0
fi

echo "üìÅ Files to check: $(echo $FILES | wc -w)"

# 2. An√°lise r√°pida de warnings nos arquivos modificados
echo ""
echo "üîß Running auto-fixes on staged files..."

# Executar fix espec√≠fico
npm run fix:specific > /dev/null 2>&1

# 3. Re-adicionar arquivos corrigidos
for FILE in $FILES; do
  if [ -f "$FILE" ]; then
    git add "$FILE"
  fi
done

# 4. Verificar TypeScript
echo ""
echo "‚úÖ Checking TypeScript..."
npx tsc --noEmit --pretty false

if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå TypeScript errors found!"
  echo "üí° Fix errors and try again, or use --no-verify to skip"
  exit 1
fi

# 5. Executar lint nos arquivos staged (n√£o bloquear)
echo ""
echo "üßπ Running ESLint..."
echo $FILES | xargs npx eslint --max-warnings 50 --quiet

if [ $? -ne 0 ]; then
  echo ""
  echo "‚ö†Ô∏è  ESLint warnings found, but commit will continue"
  echo "üí° Run 'npm run fix:all' to fix common issues"
fi

echo ""
echo "‚úÖ Pre-commit checks passed!"
exit 0
